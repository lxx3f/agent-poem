# 数据库设计

## 1. writer（作者表）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INT(11) | 作者ID，主键，自增 |
| name | VARCHAR(50) | 作者姓名，唯一键 |
| dynasty | VARCHAR(20) | 朝代，默认空字符串 |
| intro | TEXT | 作者简介 |
| detail_intro | TEXT | 作者详细介绍 |
| create_at | DATETIME | 创建时间，默认当前时间 |

## 2. poetry（诗词表）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INT(11) | 诗词ID，主键，自增 |
| title | VARCHAR(100) | 诗词标题 |
| dynasty | VARCHAR(20) | 朝代，默认空字符串 |
| writer_id | INT(11) | 作者ID，外键关联writer表，默认1（佚名） |
| keywords | VARCHAR(200) | 关键词，默认空字符串 |
| milvus_id | VARCHAR(50) | Milvus向量ID，默认空字符串 |
| content | TEXT | 诗词内容 |
| connotation | TEXT | 注释 |
| translation | TEXT | 译文 |
| remark | TEXT | 赏析 |
| create_at | DATETIME | 创建时间，默认当前时间 |

## 3. sentence（诗句表）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INT(11) | 诗句ID，主键，自增 |
| content | VARCHAR(200) | 诗句内容 |
| poetry_id | INT(11) | 关联诗词ID，外键关联poetry表，默认1 |
| create_at | DATETIME | 创建时间，默认当前时间 |

## 4. users（用户表）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 用户ID，主键，自增 |
| email | VARCHAR(128) | 登录邮箱，唯一键 |
| password_hash | VARCHAR(255) | 密码哈希 |
| username | VARCHAR(64) | 用户名/昵称 |
| created_at | DATETIME | 创建时间，默认当前时间 |
| updated_at | DATETIME | 更新时间，默认当前时间，更新时自动修改 |

## 5. agents（智能体表）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | Agent ID，主键，自增 |
| name | VARCHAR(64) | Agent 名称（展示用） |
| code | VARCHAR(64) | Agent 唯一标识，如 feihualing_v1，唯一键 |
| description | VARCHAR(255) | Agent 描述 |
| workflow_key | VARCHAR(64) | 绑定的 workflow key |
| system_prompt | TEXT | Agent 规则 Prompt（system role） |
| parameters | JSON | workflow 参数配置（如关键词、轮次限制等） |
| llm_config | JSON | 模型配置，如 model / temperature / max_tokens |
| is_active | TINYINT | 是否启用，默认1 |
| created_at | DATETIME | 创建时间，默认当前时间 |
| updated_at | DATETIME | 更新时间，默认当前时间，更新时自动修改 |

## 6. conversations（会话表）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 会话ID，主键，自增 |
| user_id | BIGINT | 所属用户ID，外键关联users表 |
| title | VARCHAR(128) | 会话标题 |
| agent_id | BIGINT | 所属agentID，外键关联agents表 |
| created_at | DATETIME | 创建时间，默认当前时间 |
| updated_at | DATETIME | 更新时间，默认当前时间，更新时自动修改 |

## 7. messages（消息表）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 消息ID，主键，自增 |
| conversation_id | BIGINT | 所属会话ID，外键关联conversations表 |
| role | ENUM('user', 'assistant', 'system') | 消息角色 |
| content | TEXT | 消息内容 |
| status | ENUM('pending', 'done', 'failed') | 消息状态 |
| created_at | DATETIME | 创建时间，默认当前时间 |

## 外键关系

- poetry.writer_id → writer.id
- sentence.poetry_id → poetry.id
- conversations.user_id → users.id
- conversations.agent_id → agents.id
- messages.conversation_id → conversations.id