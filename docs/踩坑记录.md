
## 开发search API时遇到的一个问题
1. 现象

API 返回 500 Internal Server Error

后端日志报错：

OperationalError: (1054, "Unknown column 'author' in 'field list'")

KeyError: 'id'

2. 根本原因

Service 层对 MySQL 返回字段的假设，与实际 SQL 查询结果不一致

具体表现为：

SQL 中查询了不存在的列（如 author）

SQL 返回字段未包含 id，但业务层强制访问 row["id"]

或使用了字段别名（如 poetry_id），但 Service 层仍按原字段名访问

本质问题是：

数据库访问层与业务服务层之间缺乏明确、稳定的“数据结构契约”

3. 修复方式

明确在 SQL 中 显式指定字段列表

保证字段名与业务层使用完全一致：

SELECT
    id,
    title,
    dynasty,
    writer_name,
    content
FROM poetry
WHERE id IN (...)


Service 层只依赖约定字段，不感知 SQL 细节

4. 沉淀经验

不要使用 SELECT *

数据库访问层是“边界层”，应对上游提供稳定结构

业务层不应猜测数据库字段是否存在


## 数据库操作结束后cursor未关闭
with self.get_conn() as cursor: